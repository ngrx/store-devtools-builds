!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports,require("@angular/core"),require("@ngrx/store"),require("rxjs/ReplaySubject"),require("rxjs/operator/map"),require("rxjs/operator/merge"),require("rxjs/operator/observeOn"),require("rxjs/operator/scan"),require("rxjs/operator/skip"),require("rxjs/operator/withLatestFrom"),require("rxjs/scheduler/queue"),require("rxjs/Observable"),require("rxjs/observable/empty"),require("rxjs/operator/filter"),require("rxjs/operator/share"),require("rxjs/operator/switchMap"),require("rxjs/operator/takeUntil")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@ngrx/store","rxjs/ReplaySubject","rxjs/operator/map","rxjs/operator/merge","rxjs/operator/observeOn","rxjs/operator/scan","rxjs/operator/skip","rxjs/operator/withLatestFrom","rxjs/scheduler/queue","rxjs/Observable","rxjs/observable/empty","rxjs/operator/filter","rxjs/operator/share","rxjs/operator/switchMap","rxjs/operator/takeUntil"],factory):factory((global.ngrx=global.ngrx||{},global.ngrx.storeDevtools=global.ngrx.storeDevtools||{}),global.ng.core,global.ngrx.store,global.Rx,global.Rx.Observable.prototype,global.Rx.Observable.prototype,global.Rx.Observable.prototype,global.Rx.Observable.prototype,global.Rx.Observable.prototype,global.Rx.Observable.prototype,global.Rx.Scheduler,global.Rx,global.Rx.Observable,global.Rx.Observable.prototype,global.Rx.Observable.prototype,global.Rx.Observable.prototype,global.Rx.Observable.prototype)}(this,function(exports,_angular_core,_ngrx_store,rxjs_ReplaySubject,rxjs_operator_map,rxjs_operator_merge,rxjs_operator_observeOn,rxjs_operator_scan,rxjs_operator_skip,rxjs_operator_withLatestFrom,rxjs_scheduler_queue,rxjs_Observable,rxjs_observable_empty,rxjs_operator_filter,rxjs_operator_share,rxjs_operator_switchMap,rxjs_operator_takeUntil){"use strict";function difference(first,second){return first.filter(function(item){return second.indexOf(item)<0})}function unliftState(liftedState){return liftedState.computedStates[liftedState.currentStateIndex].state}function liftAction(action){return new PerformAction(action)}function applyOperators(input$,operators){return operators.reduce(function(source$,_a){var operator=_a[0],args=_a.slice(1);return operator.apply(source$,args)},input$)}function computeNextEntry(reducer,action,state,error){if(error)return{state:state,error:"Interrupted by an error up the chain"};var nextError,nextState=state;try{nextState=reducer(state,action)}catch(err){nextError=err.toString(),console.error(err.stack||err)}return{state:nextState,error:nextError}}function recomputeStates(computedStates,minInvalidatedStateIndex,reducer,committedState,actionsById,stagedActionIds,skippedActionIds){if(minInvalidatedStateIndex>=computedStates.length&&computedStates.length===stagedActionIds.length)return computedStates;for(var nextComputedStates=computedStates.slice(0,minInvalidatedStateIndex),i=minInvalidatedStateIndex;i<stagedActionIds.length;i++){var actionId=stagedActionIds[i],action=actionsById[actionId].action,previousEntry=nextComputedStates[i-1],previousState=previousEntry?previousEntry.state:committedState,previousError=previousEntry?previousEntry.error:void 0,shouldSkip=skippedActionIds.indexOf(actionId)>-1,entry=shouldSkip?previousEntry:computeNextEntry(reducer,action,previousState,previousError);nextComputedStates.push(entry)}return nextComputedStates}function liftInitialState(initialCommittedState,monitorReducer){return{monitorState:monitorReducer(void 0,{}),nextActionId:1,actionsById:{0:liftAction(INIT_ACTION)},stagedActionIds:[0],skippedActionIds:[],committedState:initialCommittedState,currentStateIndex:0,computedStates:[]}}function liftReducerWith(initialCommittedState,initialLiftedState,monitorReducer,options){return void 0===options&&(options={}),function(reducer){return function(liftedState,liftedAction){function commitExcessActions(n){for(var excess=n,idsToDelete=stagedActionIds.slice(1,excess+1),i=0;i<idsToDelete.length;i++){if(computedStates[i+1].error){excess=i,idsToDelete=stagedActionIds.slice(1,excess+1);break}delete actionsById[idsToDelete[i]]}skippedActionIds=skippedActionIds.filter(function(id){return-1===idsToDelete.indexOf(id)}),stagedActionIds=[0].concat(stagedActionIds.slice(excess+1)),committedState=computedStates[excess].state,computedStates=computedStates.slice(excess),currentStateIndex=currentStateIndex>excess?currentStateIndex-excess:0}var _a=liftedState||initialLiftedState,monitorState=_a.monitorState,actionsById=_a.actionsById,nextActionId=_a.nextActionId,stagedActionIds=_a.stagedActionIds,skippedActionIds=_a.skippedActionIds,committedState=_a.committedState,currentStateIndex=_a.currentStateIndex,computedStates=_a.computedStates;liftedState||(actionsById=Object.create(actionsById));var minInvalidatedStateIndex=0;switch(liftedAction.type){case RESET:actionsById={0:liftAction(INIT_ACTION)},nextActionId=1,stagedActionIds=[0],skippedActionIds=[],committedState=initialCommittedState,currentStateIndex=0,computedStates=[];break;case COMMIT:actionsById={0:liftAction(INIT_ACTION)},nextActionId=1,stagedActionIds=[0],skippedActionIds=[],committedState=computedStates[currentStateIndex].state,currentStateIndex=0,computedStates=[];break;case ROLLBACK:actionsById={0:liftAction(INIT_ACTION)},nextActionId=1,stagedActionIds=[0],skippedActionIds=[],currentStateIndex=0,computedStates=[];break;case TOGGLE_ACTION:var actionId_1=liftedAction.id,index=skippedActionIds.indexOf(actionId_1);skippedActionIds=-1===index?[actionId_1].concat(skippedActionIds):skippedActionIds.filter(function(id){return id!==actionId_1}),minInvalidatedStateIndex=stagedActionIds.indexOf(actionId_1);break;case SET_ACTIONS_ACTIVE:for(var start=liftedAction.start,end=liftedAction.end,active=liftedAction.active,actionIds=[],i=start;i<end;i++)actionIds.push(i);skippedActionIds=active?difference(skippedActionIds,actionIds):skippedActionIds.concat(actionIds),minInvalidatedStateIndex=stagedActionIds.indexOf(start);break;case JUMP_TO_STATE:currentStateIndex=liftedAction.index,minInvalidatedStateIndex=1/0;break;case SWEEP:stagedActionIds=difference(stagedActionIds,skippedActionIds),skippedActionIds=[],currentStateIndex=Math.min(currentStateIndex,stagedActionIds.length-1);break;case PERFORM_ACTION:options.maxAge&&stagedActionIds.length===options.maxAge&&commitExcessActions(1),currentStateIndex===stagedActionIds.length-1&&currentStateIndex++;var actionId=nextActionId++;actionsById[actionId]=liftedAction,stagedActionIds=stagedActionIds.concat([actionId]),minInvalidatedStateIndex=stagedActionIds.length-1;break;case IMPORT_STATE:_b=liftedAction.nextLiftedState,monitorState=_b.monitorState,actionsById=_b.actionsById,nextActionId=_b.nextActionId,stagedActionIds=_b.stagedActionIds,skippedActionIds=_b.skippedActionIds,committedState=_b.committedState,currentStateIndex=_b.currentStateIndex,computedStates=_b.computedStates;break;case _ngrx_store.UPDATE:case _ngrx_store.INIT:minInvalidatedStateIndex=0,options.maxAge&&stagedActionIds.length>options.maxAge&&(computedStates=recomputeStates(computedStates,minInvalidatedStateIndex,reducer,committedState,actionsById,stagedActionIds,skippedActionIds),commitExcessActions(stagedActionIds.length-options.maxAge),minInvalidatedStateIndex=1/0);break;default:minInvalidatedStateIndex=1/0}return computedStates=recomputeStates(computedStates,minInvalidatedStateIndex,reducer,committedState,actionsById,stagedActionIds,skippedActionIds),monitorState=monitorReducer(monitorState,liftedAction),{monitorState:monitorState,actionsById:actionsById,nextActionId:nextActionId,stagedActionIds:stagedActionIds,skippedActionIds:skippedActionIds,committedState:committedState,currentStateIndex:currentStateIndex,computedStates:computedStates};var _b}}}function createIsExtensionOrMonitorPresent(extension,config){return Boolean(extension)||config.monitor!==noMonitor}function createReduxDevtoolsExtension(){return"object"==typeof window&&void 0!==window.__REDUX_DEVTOOLS_EXTENSION__?window.__REDUX_DEVTOOLS_EXTENSION__:null}function createStateObservable(devtools){return devtools.state}function noMonitor(){return null}function createConfig(_options){var DEFAULT_OPTIONS={maxAge:!1,monitor:noMonitor},options="function"==typeof _options?_options():_options,config=Object.assign({},DEFAULT_OPTIONS,options);if(config.maxAge&&config.maxAge<2)throw new Error("Devtools 'maxAge' cannot be less than 2, got "+config.maxAge);return config}var __extends=function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),PERFORM_ACTION="PERFORM_ACTION",RESET="RESET",ROLLBACK="ROLLBACK",COMMIT="COMMIT",SWEEP="SWEEP",TOGGLE_ACTION="TOGGLE_ACTION",SET_ACTIONS_ACTIVE="SET_ACTIONS_ACTIVE",JUMP_TO_STATE="JUMP_TO_STATE",IMPORT_STATE="IMPORT_STATE",PerformAction=function(){function PerformAction(action,timestamp){if(this.action=action,this.timestamp=timestamp,this.type=PERFORM_ACTION,void 0===action.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?')}return PerformAction}(),Reset=function(){function Reset(timestamp){this.timestamp=timestamp,this.type=RESET}return Reset}(),Rollback=function(){function Rollback(timestamp){this.timestamp=timestamp,this.type=ROLLBACK}return Rollback}(),Commit=function(){function Commit(timestamp){this.timestamp=timestamp,this.type=COMMIT}return Commit}(),Sweep=function(){function Sweep(){this.type=SWEEP}return Sweep}(),ToggleAction=function(){function ToggleAction(id){this.id=id,this.type=TOGGLE_ACTION}return ToggleAction}(),JumpToState=function(){function JumpToState(index){this.index=index,this.type=JUMP_TO_STATE}return JumpToState}(),ImportState=function(){function ImportState(nextLiftedState){this.nextLiftedState=nextLiftedState,this.type=IMPORT_STATE}return ImportState}(),ExtensionActionTypes={START:"START",DISPATCH:"DISPATCH",STOP:"STOP",ACTION:"ACTION"},REDUX_DEVTOOLS_EXTENSION=new _angular_core.InjectionToken("Redux Devtools Extension"),DevtoolsExtension=function(){function DevtoolsExtension(devtoolsExtension){this.instanceId="ngrx-store-"+Date.now(),this.devtoolsExtension=devtoolsExtension,this.createActionStreams()}return DevtoolsExtension.prototype.notify=function(action,state){this.devtoolsExtension&&this.devtoolsExtension.send(null,state,!1,this.instanceId)},DevtoolsExtension.prototype.createChangesObservable=function(){var _this=this;return this.devtoolsExtension?new rxjs_Observable.Observable(function(subscriber){var connection=_this.devtoolsExtension.connect({instanceId:_this.instanceId});return connection.subscribe(function(change){return subscriber.next(change)}),connection.unsubscribe}):rxjs_observable_empty.empty()},DevtoolsExtension.prototype.createActionStreams=function(){var _this=this,changes$=rxjs_operator_share.share.call(this.createChangesObservable()),start$=rxjs_operator_filter.filter.call(changes$,function(change){return change.type===ExtensionActionTypes.START}),stop$=rxjs_operator_filter.filter.call(changes$,function(change){return change.type===ExtensionActionTypes.STOP}),liftedActions$=applyOperators(changes$,[[rxjs_operator_filter.filter,function(change){return change.type===ExtensionActionTypes.DISPATCH}],[rxjs_operator_map.map,function(change){return _this.unwrapAction(change.payload)}]]),actions$=applyOperators(changes$,[[rxjs_operator_filter.filter,function(change){return change.type===ExtensionActionTypes.ACTION}],[rxjs_operator_map.map,function(change){return _this.unwrapAction(change.payload)}]]),actionsUntilStop$=rxjs_operator_takeUntil.takeUntil.call(actions$,stop$),liftedUntilStop$=rxjs_operator_takeUntil.takeUntil.call(liftedActions$,stop$);this.actions$=rxjs_operator_switchMap.switchMap.call(start$,function(){return actionsUntilStop$}),this.liftedActions$=rxjs_operator_switchMap.switchMap.call(start$,function(){return liftedUntilStop$})},DevtoolsExtension.prototype.unwrapAction=function(action){return"string"==typeof action?eval("("+action+")"):action},DevtoolsExtension}();DevtoolsExtension.decorators=[{type:_angular_core.Injectable}],DevtoolsExtension.ctorParameters=function(){return[{type:void 0,decorators:[{type:_angular_core.Inject,args:[REDUX_DEVTOOLS_EXTENSION]}]}]};var INIT_ACTION={type:_ngrx_store.INIT},STORE_DEVTOOLS_CONFIG=new _angular_core.InjectionToken("@ngrx/devtools Options"),INITIAL_OPTIONS=new _angular_core.InjectionToken("@ngrx/devtools Initial Config"),DevtoolsDispatcher=function(_super){function DevtoolsDispatcher(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(DevtoolsDispatcher,_super),DevtoolsDispatcher}(_ngrx_store.ActionsSubject);DevtoolsDispatcher.decorators=[{type:_angular_core.Injectable}],DevtoolsDispatcher.ctorParameters=function(){return[]};var StoreDevtools=function(){function StoreDevtools(dispatcher,actions$,reducers$,extension,scannedActions,initialState,config){var liftedInitialState=liftInitialState(initialState,config.monitor),liftReducer=liftReducerWith(initialState,liftedInitialState,config.monitor,config.maxAge?{maxAge:config.maxAge}:{}),liftedAction$=applyOperators(actions$.asObservable(),[[rxjs_operator_skip.skip,1],[rxjs_operator_merge.merge,extension.actions$],[rxjs_operator_map.map,liftAction],[rxjs_operator_merge.merge,dispatcher,extension.liftedActions$],[rxjs_operator_observeOn.observeOn,rxjs_scheduler_queue.queue]]),liftedReducer$=rxjs_operator_map.map.call(reducers$,liftReducer),liftedStateSubject=new rxjs_ReplaySubject.ReplaySubject(1),liftedStateSubscription=applyOperators(liftedAction$,[[rxjs_operator_withLatestFrom.withLatestFrom,liftedReducer$],[rxjs_operator_scan.scan,function(_a,_b){var liftedState=_a.state,action=_b[0],reducer=_b[1],state=reducer(liftedState,action);return extension.notify(action,state),{state:state,action:action}},{state:liftedInitialState,action:null}]]).subscribe(function(_a){var state=_a.state,action=_a.action;if(liftedStateSubject.next(state),action.type===PERFORM_ACTION){var unlifedAction=action.action;scannedActions.next(unlifedAction)}}),liftedState$=liftedStateSubject.asObservable(),state$=rxjs_operator_map.map.call(liftedState$,unliftState);this.stateSubscription=liftedStateSubscription,this.dispatcher=dispatcher,this.liftedState=liftedState$,this.state=state$}return StoreDevtools.prototype.dispatch=function(action){this.dispatcher.next(action)},StoreDevtools.prototype.next=function(action){this.dispatcher.next(action)},StoreDevtools.prototype.error=function(error){},StoreDevtools.prototype.complete=function(){},StoreDevtools.prototype.performAction=function(action){this.dispatch(new PerformAction(action))},StoreDevtools.prototype.reset=function(){this.dispatch(new Reset)},StoreDevtools.prototype.rollback=function(){this.dispatch(new Rollback)},StoreDevtools.prototype.commit=function(){this.dispatch(new Commit)},StoreDevtools.prototype.sweep=function(){this.dispatch(new Sweep)},StoreDevtools.prototype.toggleAction=function(id){this.dispatch(new ToggleAction(id))},StoreDevtools.prototype.jumpToState=function(index){this.dispatch(new JumpToState(index))},StoreDevtools.prototype.importState=function(nextLiftedState){this.dispatch(new ImportState(nextLiftedState))},StoreDevtools}();StoreDevtools.decorators=[{type:_angular_core.Injectable}],StoreDevtools.ctorParameters=function(){return[{type:DevtoolsDispatcher},{type:_ngrx_store.ActionsSubject},{type:_ngrx_store.ReducerObservable},{type:DevtoolsExtension},{type:_ngrx_store.ScannedActionsSubject},{type:void 0,decorators:[{type:_angular_core.Inject,args:[_ngrx_store.INITIAL_STATE]}]},{type:void 0,decorators:[{type:_angular_core.Inject,args:[STORE_DEVTOOLS_CONFIG]}]}]};var IS_EXTENSION_OR_MONITOR_PRESENT=new _angular_core.InjectionToken("Is Devtools Extension or Monitor Present"),StoreDevtoolsModule=function(){function StoreDevtoolsModule(){}return StoreDevtoolsModule.instrument=function(options){return void 0===options&&(options={}),{ngModule:StoreDevtoolsModule,providers:[{provide:INITIAL_OPTIONS,useValue:options},{provide:IS_EXTENSION_OR_MONITOR_PRESENT,deps:[REDUX_DEVTOOLS_EXTENSION,STORE_DEVTOOLS_CONFIG],useFactory:createIsExtensionOrMonitorPresent},{provide:REDUX_DEVTOOLS_EXTENSION,useFactory:createReduxDevtoolsExtension},{provide:STORE_DEVTOOLS_CONFIG,deps:[INITIAL_OPTIONS],useFactory:createConfig},{provide:_ngrx_store.StateObservable,deps:[StoreDevtools],useFactory:createStateObservable},{provide:_ngrx_store.ReducerManagerDispatcher,useExisting:DevtoolsDispatcher}]}},StoreDevtoolsModule}();StoreDevtoolsModule.decorators=[{type:_angular_core.NgModule,args:[{imports:[_ngrx_store.StoreModule],providers:[DevtoolsExtension,DevtoolsDispatcher,StoreDevtools]}]}],StoreDevtoolsModule.ctorParameters=function(){return[]},exports.StoreDevtoolsModule=StoreDevtoolsModule,exports.StoreDevtools=StoreDevtools,exports.ɵi=INITIAL_OPTIONS,exports.ɵh=STORE_DEVTOOLS_CONFIG,exports.ɵg=DevtoolsDispatcher,exports.ɵk=DevtoolsExtension,exports.ɵj=REDUX_DEVTOOLS_EXTENSION,exports.ɵa=IS_EXTENSION_OR_MONITOR_PRESENT,exports.ɵf=createConfig,exports.ɵb=createIsExtensionOrMonitorPresent,exports.ɵc=createReduxDevtoolsExtension,exports.ɵd=createStateObservable,exports.ɵe=noMonitor,Object.defineProperty(exports,"__esModule",{value:!0})});
//# sourceMappingURL=./dist/store-devtools/bundles/store-devtools.umd.min.js.map