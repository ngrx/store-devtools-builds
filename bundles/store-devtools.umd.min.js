!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@ngrx/store"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@ngrx/store-devtools",["exports","@angular/core","@ngrx/store","rxjs","rxjs/operators"],e):e((t.ngrx=t.ngrx||{},t.ngrx.storeDevtools={}),t.ng.core,t.ngrx.store,t.Rx,t.operators)}(this,function(exports,core,store,rxjs,operators){"use strict";var __extends=(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},function(t,e){function o(){this.constructor=t}c(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),c,StoreDevtoolsConfig=function(){},STORE_DEVTOOLS_CONFIG=new core.InjectionToken("@ngrx/devtools Options"),INITIAL_OPTIONS=new core.InjectionToken("@ngrx/devtools Initial Config"),PERFORM_ACTION="PERFORM_ACTION",REFRESH="REFRESH",RESET="RESET",ROLLBACK="ROLLBACK",COMMIT="COMMIT",SWEEP="SWEEP",TOGGLE_ACTION="TOGGLE_ACTION",SET_ACTIONS_ACTIVE="SET_ACTIONS_ACTIVE",JUMP_TO_STATE="JUMP_TO_STATE",JUMP_TO_ACTION="JUMP_TO_ACTION",IMPORT_STATE="IMPORT_STATE",PerformAction=function(t,e){if(this.action=t,this.timestamp=e,this.type=PERFORM_ACTION,void 0===t.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?')},Refresh=function(){this.type=REFRESH},Reset=function(t){this.timestamp=t,this.type=RESET},Rollback=function(t){this.timestamp=t,this.type=ROLLBACK},Commit=function(t){this.timestamp=t,this.type=COMMIT},Sweep=function(){this.type=SWEEP},ToggleAction=function(t){this.id=t,this.type=TOGGLE_ACTION},JumpToState=function(t){this.index=t,this.type=JUMP_TO_STATE},JumpToAction=function(t){this.actionId=t,this.type=JUMP_TO_ACTION},ImportState=function(t){this.nextLiftedState=t,this.type=IMPORT_STATE};function difference(t,e){return t.filter(function(t){return e.indexOf(t)<0})}function unliftState(t){return t.computedStates[t.currentStateIndex].state}function liftAction(t){return new PerformAction(t,+Date.now())}function sanitizeActions(n,r){return Object.keys(r).reduce(function(t,e){var o=Number(e);return t[o]=sanitizeAction(n,r[o],o),t},{})}function sanitizeAction(t,e,o){return Object.assign({},e,{action:t(e.action,o)})}function sanitizeStates(o,t){return t.map(function(t,e){return{state:sanitizeState(o,t.state,e),error:t.error}})}function sanitizeState(t,e,o){return t(e,o)}var ExtensionActionTypes={START:"START",DISPATCH:"DISPATCH",STOP:"STOP",ACTION:"ACTION"},REDUX_DEVTOOLS_EXTENSION=new core.InjectionToken("Redux Devtools Extension"),DevtoolsExtension=function(){function DevtoolsExtension(t,e){this.config=e,this.instanceId="ngrx-store-"+Date.now(),this.devtoolsExtension=t,this.createActionStreams()}return DevtoolsExtension.prototype.notify=function(t,e){if(this.devtoolsExtension)if(t.type===PERFORM_ACTION){var o=unliftState(e),n=this.config.stateSanitizer?sanitizeState(this.config.stateSanitizer,o,e.currentStateIndex):o,r=this.config.actionSanitizer?sanitizeAction(this.config.actionSanitizer,t,e.nextActionId):t;this.extensionConnection.send(r,n)}else{var i=Object.assign({},e,{actionsById:this.config.actionSanitizer?sanitizeActions(this.config.actionSanitizer,e.actionsById):e.actionsById,computedStates:this.config.stateSanitizer?sanitizeStates(this.config.stateSanitizer,e.computedStates):e.computedStates});this.devtoolsExtension.send(null,i,this.getExtensionConfig(this.instanceId,this.config),this.instanceId)}},DevtoolsExtension.prototype.createChangesObservable=function(){var o=this;return this.devtoolsExtension?new rxjs.Observable(function(e){var t=o.devtoolsExtension.connect(o.getExtensionConfig(o.instanceId,o.config));return(o.extensionConnection=t).init(),t.subscribe(function(t){return e.next(t)}),t.unsubscribe}):rxjs.empty()},DevtoolsExtension.prototype.createActionStreams=function(){var e=this,t=this.createChangesObservable().pipe(operators.share()),o=t.pipe(operators.filter(function(t){return t.type===ExtensionActionTypes.START})),n=t.pipe(operators.filter(function(t){return t.type===ExtensionActionTypes.STOP})),r=t.pipe(operators.filter(function(t){return t.type===ExtensionActionTypes.DISPATCH}),operators.map(function(t){return e.unwrapAction(t.payload)})),i=t.pipe(operators.filter(function(t){return t.type===ExtensionActionTypes.ACTION}),operators.map(function(t){return e.unwrapAction(t.payload)})).pipe(operators.takeUntil(n)),s=r.pipe(operators.takeUntil(n));this.start$=o.pipe(operators.takeUntil(n)),this.actions$=this.start$.pipe(operators.switchMap(function(){return i})),this.liftedActions$=this.start$.pipe(operators.switchMap(function(){return s}))},DevtoolsExtension.prototype.unwrapAction=function(action){return"string"==typeof action?eval("("+action+")"):action},DevtoolsExtension.prototype.getExtensionConfig=function(t,e){var o={instanceId:t,name:e.name,features:e.features,serialize:e.serialize};return!1!==e.maxAge&&(o.maxAge=e.maxAge),o},DevtoolsExtension}();DevtoolsExtension.decorators=[{type:core.Injectable}],DevtoolsExtension.ctorParameters=function(){return[{type:void 0,decorators:[{type:core.Inject,args:[REDUX_DEVTOOLS_EXTENSION]}]},{type:StoreDevtoolsConfig,decorators:[{type:core.Inject,args:[STORE_DEVTOOLS_CONFIG]}]}]};var INIT_ACTION={type:store.INIT};function computeNextEntry(t,e,o,n,r){if(n)return{state:o,error:"Interrupted by an error up the chain"};var i,s=o;try{s=t(o,e)}catch(t){i=t.toString(),r.handleError(t.stack||t)}return{state:s,error:i}}function recomputeStates(t,e,o,n,r,i,s,a){if(e>=t.length&&t.length===i.length)return t;for(var c=t.slice(0,e),p=e;p<i.length;p++){var u=i[p],f=r[u].action,l=c[p-1],d=l?l.state:n,S=l?l.error:void 0,O=-1<s.indexOf(u)?l:computeNextEntry(o,f,d,S,a);c.push(O)}return c}function liftInitialState(t,e){return{monitorState:e(void 0,{}),nextActionId:1,actionsById:{0:liftAction(INIT_ACTION)},stagedActionIds:[0],skippedActionIds:[],committedState:t,currentStateIndex:0,computedStates:[]}}function liftReducerWith(g,m,y,_,D){return void 0===D&&(D={}),function(v){return function(t,e){var o=t||m,n=o.monitorState,r=o.actionsById,i=o.nextActionId,s=o.stagedActionIds,a=o.skippedActionIds,c=o.committedState,p=o.currentStateIndex,u=o.computedStates;function f(t){for(var e=t,o=s.slice(1,e+1),n=0;n<o.length;n++){if(u[n+1].error){e=n,o=s.slice(1,e+1);break}delete r[o[n]]}a=a.filter(function(t){return-1===o.indexOf(t)}),s=[0].concat(s.slice(e+1)),c=u[e].state,u=u.slice(e),p=e<p?p-e:0}t||(r=Object.create(r));var l,d=0;switch(e.type){case RESET:r={0:liftAction(INIT_ACTION)},i=1,s=[0],a=[],c=g,p=0,u=[];break;case COMMIT:r={0:liftAction(INIT_ACTION)},i=1,s=[0],a=[],c=u[p].state,p=0,u=[];break;case ROLLBACK:r={0:liftAction(INIT_ACTION)},i=1,s=[0],a=[],p=0,u=[];break;case TOGGLE_ACTION:var S=e.id;a=-1===(h=a.indexOf(S))?[S].concat(a):a.filter(function(t){return t!==S}),d=s.indexOf(S);break;case SET_ACTIONS_ACTIVE:for(var O=e.start,T=e.end,I=e.active,E=[],x=O;x<T;x++)E.push(x);a=I?difference(a,E):a.concat(E),d=s.indexOf(O);break;case JUMP_TO_STATE:p=e.index,d=1/0;break;case JUMP_TO_ACTION:var h;-1!==(h=s.indexOf(e.actionId))&&(p=h),d=1/0;break;case SWEEP:s=difference(s,a),a=[],p=Math.min(p,s.length-1);break;case PERFORM_ACTION:D.maxAge&&s.length===D.maxAge&&f(1),p===s.length-1&&p++;var A=i++;r[A]=e,d=(s=s.concat([A])).length-1;break;case IMPORT_STATE:n=(l=e.nextLiftedState).monitorState,r=l.actionsById,i=l.nextActionId,s=l.stagedActionIds,a=l.skippedActionIds,c=l.committedState,p=l.currentStateIndex,u=l.computedStates;break;case store.INIT:d=0,D.maxAge&&s.length>D.maxAge&&(u=recomputeStates(u,d,v,c,r,s,a,y),f(s.length-D.maxAge),d=1/0);break;case store.UPDATE:if(0<u.filter(function(t){return t.error}).length)d=0,D.maxAge&&s.length>D.maxAge&&(u=recomputeStates(u,d,v,c,r,s,a,y),f(s.length-D.maxAge),d=1/0);else{p===s.length-1&&p++;A=i++;r[A]=new PerformAction(e,+Date.now()),d=(s=s.concat([A])).length-1,u=(u=recomputeStates(u,d,v,c,r,s,a,y)).map(function(t){return Object.assign({},t,{state:v(t.state,e)})}),p=d,D.maxAge&&s.length>D.maxAge&&f(s.length-D.maxAge),d=1/0}break;default:d=1/0}return u=recomputeStates(u,d,v,c,r,s,a,y),{monitorState:n=_(n,e),actionsById:r,nextActionId:i,stagedActionIds:s,skippedActionIds:a,committedState:c,currentStateIndex:p,computedStates:u}}}}var DevtoolsDispatcher=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(store.ActionsSubject);DevtoolsDispatcher.decorators=[{type:core.Injectable}];var StoreDevtools=function(){function t(t,e,o,i,r,n,s,a){var c=this,p=liftInitialState(s,a.monitor),u=liftReducerWith(s,p,n,a.monitor,a),f=rxjs.merge(rxjs.merge(e.asObservable().pipe(operators.skip(1)),i.actions$).pipe(operators.map(liftAction)),t,i.liftedActions$).pipe(operators.observeOn(rxjs.queueScheduler)),l=o.pipe(operators.map(u)),d=new rxjs.ReplaySubject(1),S=f.pipe(operators.withLatestFrom(l),operators.scan(function(t,e){var o=t.state,n=e[0],r=(0,e[1])(o,n);return i.notify(n,r),{state:r,action:n}},{state:p,action:null})).subscribe(function(t){var e=t.state,o=t.action;if(d.next(e),o.type===PERFORM_ACTION){var n=o.action;r.next(n)}}),O=i.start$.subscribe(function(){c.refresh()}),T=d.asObservable(),I=T.pipe(operators.map(unliftState));this.extensionStartSubscription=O,this.stateSubscription=S,this.dispatcher=t,this.liftedState=T,this.state=I}return t.prototype.dispatch=function(t){this.dispatcher.next(t)},t.prototype.next=function(t){this.dispatcher.next(t)},t.prototype.error=function(t){},t.prototype.complete=function(){},t.prototype.performAction=function(t){this.dispatch(new PerformAction(t,+Date.now()))},t.prototype.refresh=function(){this.dispatch(new Refresh)},t.prototype.reset=function(){this.dispatch(new Reset(+Date.now()))},t.prototype.rollback=function(){this.dispatch(new Rollback(+Date.now()))},t.prototype.commit=function(){this.dispatch(new Commit(+Date.now()))},t.prototype.sweep=function(){this.dispatch(new Sweep)},t.prototype.toggleAction=function(t){this.dispatch(new ToggleAction(t))},t.prototype.jumpToAction=function(t){this.dispatch(new JumpToAction(t))},t.prototype.jumpToState=function(t){this.dispatch(new JumpToState(t))},t.prototype.importState=function(t){this.dispatch(new ImportState(t))},t}();StoreDevtools.decorators=[{type:core.Injectable}],StoreDevtools.ctorParameters=function(){return[{type:DevtoolsDispatcher},{type:store.ActionsSubject},{type:store.ReducerObservable},{type:DevtoolsExtension},{type:store.ScannedActionsSubject},{type:core.ErrorHandler},{type:void 0,decorators:[{type:core.Inject,args:[store.INITIAL_STATE]}]},{type:StoreDevtoolsConfig,decorators:[{type:core.Inject,args:[STORE_DEVTOOLS_CONFIG]}]}]};var IS_EXTENSION_OR_MONITOR_PRESENT=new core.InjectionToken("Is Devtools Extension or Monitor Present");function createIsExtensionOrMonitorPresent(t,e){return Boolean(t)||e.monitor!==noMonitor}function createReduxDevtoolsExtension(){var t="__REDUX_DEVTOOLS_EXTENSION__";return"object"==typeof window&&void 0!==window[t]?window[t]:null}function createStateObservable(t){return t.state}function noMonitor(){return null}var DEFAULT_NAME="NgRx Store DevTools";function createConfig(t){var e={maxAge:!1,monitor:noMonitor,actionSanitizer:void 0,stateSanitizer:void 0,name:DEFAULT_NAME,serialize:!1,logOnly:!1,features:!1},o="function"==typeof t?t():t,n=!!o.logOnly&&{pause:!0,export:!0,test:!0},r=o.features||n,i=Object.assign({},e,{features:r},o);if(i.maxAge&&i.maxAge<2)throw new Error("Devtools 'maxAge' cannot be less than 2, got "+i.maxAge);return i}var StoreDevtoolsModule=function(){function e(){}return e.instrument=function(t){return void 0===t&&(t={}),{ngModule:e,providers:[DevtoolsExtension,DevtoolsDispatcher,StoreDevtools,{provide:INITIAL_OPTIONS,useValue:t},{provide:IS_EXTENSION_OR_MONITOR_PRESENT,deps:[REDUX_DEVTOOLS_EXTENSION,STORE_DEVTOOLS_CONFIG],useFactory:createIsExtensionOrMonitorPresent},{provide:REDUX_DEVTOOLS_EXTENSION,useFactory:createReduxDevtoolsExtension},{provide:STORE_DEVTOOLS_CONFIG,deps:[INITIAL_OPTIONS],useFactory:createConfig},{provide:store.StateObservable,deps:[StoreDevtools],useFactory:createStateObservable},{provide:store.ReducerManagerDispatcher,useExisting:DevtoolsDispatcher}]}},e}();StoreDevtoolsModule.decorators=[{type:core.NgModule,args:[{}]}],exports.StoreDevtoolsModule=StoreDevtoolsModule,exports.StoreDevtools=StoreDevtools,exports.StoreDevtoolsConfig=StoreDevtoolsConfig,exports.ɵi=INITIAL_OPTIONS,exports.ɵh=STORE_DEVTOOLS_CONFIG,exports.ɵg=DevtoolsDispatcher,exports.ɵk=DevtoolsExtension,exports.ɵj=REDUX_DEVTOOLS_EXTENSION,exports.ɵa=IS_EXTENSION_OR_MONITOR_PRESENT,exports.ɵf=createConfig,exports.ɵb=createIsExtensionOrMonitorPresent,exports.ɵc=createReduxDevtoolsExtension,exports.ɵd=createStateObservable,exports.ɵe=noMonitor,Object.defineProperty(exports,"__esModule",{value:!0})});